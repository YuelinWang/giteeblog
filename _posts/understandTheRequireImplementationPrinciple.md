---
title: 彻底搞懂 Node.js 中的 Require 机制(源码分析到手写实践)
excerpt: 关于require的实现原理
categories:
- 技术文章
tags:
- js
---

## 前言
本文你能学到：
1. 自己手写实现一个 require，面试用也可以。
2. 如何看 Node.js 源码
3. require 函数是如何产生的？为什么在 module 中可以直接使用。
4. require 加载原生模块时候如何处理的，为什么 require('net') 可以直接找到
5. Node.js 中 require 会出现循环引用问题吗？
6. require 是同步还是异步的？为什么？
7. exports 和 module.exports 的区别是什么？
8. 你知道 require 加载的过程中使用了 vm 模块吗？vm 模块是做什么的？vm 模块除了 require 源码用到还有哪些应用场景。

## 什么是 CommonJS
每一个文件就是一个模块，拥有自己独立的作用域，变量，以及方法等，对其他的模块都不可见。CommonJS 规范规定，每个模块内部，module 变量代表当前模块。这个变量是一个对象，它的exports属性（即module.exports）是对外的接口。

## 模块分类
- 原生(核心)模块：Node 提供的模块我们都称之为原生模块
    - 内建模块:Node.js 原生提供的模块中，由纯 C/C++ 编写的称为内建模块
    - 全局模块：Node.js在启动时，会生成一个全局量 process
    - 除了上面两种可以直接 require 的所有原生模块
- 文件模块：用户编写的模块
    - 普通文件模块：node_modules 下面的模块，或者我们自己开发时候写的每个文件内容。
    - C++ 扩展模块：用户自己编写的 C++ 扩展模块或者第三方 C++ 扩展模块

## 模块加载
介绍了上面的模块分类，正常应该到介绍不同模块的加载环节，这里不这样,只列出目录。先带你看一遍源码，再手写一下，然后我想你自己总结一下这几种模块的加载区别。
**加载 Node.js 原生模块**
本文不包括直接调用内建纯C/C++模块，也不推荐这样使用，因为我们正常调用的原生模块都是通过 js封装一层，它们自己再去调用，你想直接调用的 Node.js提供的存C/C++ 内建模块，js 封装的一层也都能做到。那部分内容放在 Node.js与 C++ 那些事的文章中介绍。
**require 加载普通文件模块**
**require 加载 C++ 扩展文件模块**

## require 加载原理(源码分析与手写)